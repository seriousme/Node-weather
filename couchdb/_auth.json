{"_id":"_design/_auth","_rev":"2-b533a15ceb3ee3d88dbeec7f1d4c2803","language":"javascript","validate_doc_update":"\n    function(newDoc, oldDoc, userCtx, secObj) {\n\t var is_server_or_database_admin = function(userCtx, secObj) {\n            // see if the user is a server admin\n            if(userCtx.roles.indexOf('_admin') !== -1) {\n                return true; // a server admin\n            }\n\n            // see if the user a database admin specified by name\n            if(secObj && secObj.admins && secObj.admins.names) {\n                if(secObj.admins.names.indexOf(userCtx.name) !== -1) {\n                    return true; // database admin\n                }\n            }\n\n            // see if the user a database admin specified by role\n            if(secObj && secObj.admins && secObj.admins.roles) {\n                var db_roles = secObj.admins.roles;\n                for(var idx = 0; idx < userCtx.roles.length; idx++) {\n                    var user_role = userCtx.roles[idx];\n                    if(db_roles.indexOf(user_role) !== -1) {\n                        return true; // role matches!\n                    }\n                }\n            }\n\n            return false; // default to no admin\n        }\n\n        // allow updates only by server or DB admins\n        if (!is_server_or_database_admin(userCtx, secObj)) {\n\t\t throw({forbidden: 'Only admins may update/delete docs.'});\n\t}\n    }"}
